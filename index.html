<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>가스 모니터링 시스템</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="fontawesome.css" />
  </head>
  <body>
    <div class="app">
      <!-- 헤더 -->
      <header class="header">
        <div class="header-content">
          <div class="header-controls">
            <div class="connection-status" id="connectionStatus">
              <span class="status-text">센서 정보 로딩중...</span>
            </div>
            <button class="btn btn-secondary" id="settingsBtn">설정</button>
            <button class="btn btn-primary" id="reconnectBtn">재연결</button>
          </div>
        </div>
      </header>

      <!-- 메인 컨텐츠 -->
      <main class="main-content">
        <!-- 로딩 상태 -->
        <div class="loading-container" id="loadingContainer">
          <div class="loading-spinner"></div>
          <p>센서 정보를 불러오는 중...</p>
        </div>

        <!-- 센서 그리드 -->

        <div class="sensor-grid" id="sensorGrid" style="display: none">
          <!-- 센서 카드들이 동적으로 생성됩니다 -->
        </div>

        <!-- 에러 메시지 -->
        <div class="error-container" id="errorContainer" style="display: none">
          <div class="error-content">
            <h3>연결 오류</h3>
            <p id="errorMessage">센서 서버에 연결할 수 없습니다.</p>
            <button class="btn btn-primary" onclick="loadSensors()">
              다시 시도
            </button>
          </div>
        </div>
      </main>

      <!-- 마지막 업데이트 시간 & 재연결 -->
      <footer class="footer">
        <div class="footer-content">
          <span>마지막 업데이트: <span id="lastUpdateTime">--</span></span>
          <span>설치 센서: <span id="totalSensors">0</span>개</span>
        </div>
      </footer>
    </div>

    <!-- 배기팬 표시 -->
    <div class="fan-display"></div>

    <!-- 설정 모달 -->
    <div class="modal" id="settingsModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>설정</h2>
          <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="settings-section">
            <h3>서버 설정</h3>
            <div class="form-group">
              <label for="serverIp">서버 IP</label>
              <input
                type="text"
                id="serverIp"
                value="localhost"
                placeholder="예: 192.168.0.224"
              />
            </div>
            <div class="form-group">
              <label for="serverPort">서버 Port</label>
              <input
                type="text"
                id="serverPort"
                value="8081"
                placeholder="예: 8080"
              />
            </div>
            <div class="connection-info">
              <h4>연결 정보</h4>
              <p>
                API:
                <span id="apiUrl"
                  >http://localhost:8081/api/sensor/mappings</span
                >
              </p>
              <p>
                WebSocket: <span id="wsUrl">ws://localhost:8081/ws/sensor</span>
              </p>
            </div>
          </div>

          <div class="settings-section">
            <h3>회전경광등</h3>

            <div class="form-group form-control connection-info">
              <p>회전경광등 제어</p>
              <div>
                <button class="btn" onclick="callAlertAPI(true, true)">
                  <img src="alram-on.png" style="width: 20px" alt="켜기" /> 켜기
                </button>
                <button class="btn" onclick="callAlertAPI(false, true)">
                  <img src="alram-off.png" style="width: 20px" alt="끄기" />
                  끄기
                </button>
              </div>

              <div style="margin-top: 20px">
                <p>알림모드 제어</p>
                <div class="form-group" style="display: flex; gap: 10px">
                  알람 끔(OFF)<label
                    class="switch"
                    title="회전경광등 켜기/끄기"
                  >
                    <input
                      type="checkbox"
                      id="beaconToggle"
                      onchange="toggleAlarmMaster(this.checked)"
                    />
                    <span class="slider"></span> </label
                  >위험시 알람(ON)
                </div>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h3>배기팬 표시 위치</h3>
            <div class="form-group form-control connection-info">
              <p>화면에서 배기팬 표시 위치를 선택하세요</p>
              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 10px;
                  margin-top: 10px;
                "
              >
                <button
                  class="btn position-btn"
                  onclick="changeFanPosition('top-left')"
                >
                  왼쪽 상단
                </button>
                <button
                  class="btn position-btn"
                  onclick="changeFanPosition('top-right')"
                >
                  우측 상단
                </button>
                <button
                  class="btn position-btn"
                  onclick="changeFanPosition('bottom-left')"
                >
                  왼쪽 하단
                </button>
                <button
                  class="btn position-btn"
                  onclick="changeFanPosition('bottom-right')"
                >
                  우측 하단
                </button>
              </div>
              <p style="margin-top: 10px; font-size: 14px; color: #666">
                현재 위치: <span id="currentFanPosition">우측 상단</span>
              </p>
            </div>
          </div>

          <!-- <div class="settings-section">
            <h3>배기팬 1</h3>
            <div class="form-group form-control connection-info">
              <p>배기팬 1 제어</p>
              <div style="display: flex; align-items: center; gap: 20px;">
                <img id="fan1SettingImage" src="fan_off.webp" style="width: 60px; height: 60px;" alt="배기팬 1" />
                <div>
                  <button class="btn" onclick="callFan1API(true)">팬1 켜기</button>
                  <button class="btn" onclick="callFan1API(false)">팬1 끄기</button>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <h3>배기팬 2</h3>
            <div class="form-group form-control connection-info">
              <p>배기팬 2 제어</p>
              <div style="display: flex; align-items: center; gap: 20px;">
                <img id="fan2SettingImage" src="fan_off.webp" style="width: 60px; height: 60px;" alt="배기팬 2" />
                <div>
                  <button class="btn" onclick="callFan2API(true)">팬2 켜기</button>
                  <button class="btn" onclick="callFan2API(false)">팬2 끄기</button>
              </div>
            </div>
          </div> -->

          <div class="settings-section">
            <h3>센서 목록 (<span id="sensorCount">0</span>개)</h3>
            <div class="sensor-list" id="sensorList">
              <div class="no-sensors">
                <p>등록된 센서가 없습니다</p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelBtn">취소</button>
          <button class="btn btn-primary" id="saveBtn">저장</button>
        </div>
      </div>
    </div>

    <!-- 임계치 설정 모달 -->
    <div class="modal" id="thresholdModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>임계치 설정</h2>
          <button class="modal-close" id="closeThresholdModal">&times;</button>
        </div>
        <div class="modal-body">
          <div id="thresholdContent">
            <!-- 임계치 설정 내용이 동적으로 생성됩니다 -->
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelThresholdBtn">
            취소
          </button>
          <button class="btn btn-primary" id="saveThresholdBtn">저장</button>
        </div>
      </div>
    </div>

    <!-- JavaScript 파일들을 올바른 순서로 로드 -->
    <!-- 1. 외부 라이브러리 -->
    <script src="sensor-info.js"></script>
    <script src="websocket-client.js"></script>

    <!-- 2. 설정 및 전역 변수 -->
    <script src="js/config.js"></script>

    <!-- 3. 유틸리티 -->
    <script src="js/utils.js"></script>

    <!-- 4. 로컬 스토리지 관리 -->
    <script src="js/storage.js"></script>

    <!-- 5. UI 상태 관리 -->
    <script src="js/ui-state.js"></script>

    <!-- 6. UI 렌더링 -->
    <script src="js/ui-render.js"></script>

    <!-- 7. 모달 관리 -->
    <script src="js/modal.js"></script>

    <!-- 8. 임계치 관리 -->
    <script src="js/threshold.js"></script>

    <!-- 9. 센서 데이터 -->
    <script src="js/sensor-data.js"></script>

    <!-- 10. 센서 헬스 체크 -->
    <script src="js/sensor-health.js"></script>

    <!-- 11. WebSocket 관리 -->
    <script src="js/websocket.js"></script>

    <!-- 12. 알람 시스템 -->
    <script src="js/alarm.js"></script>

    <!-- 13. 메인 초기화 (마지막에 로드) -->
    <script src="js/main.js"></script>
  </body>
</html>
